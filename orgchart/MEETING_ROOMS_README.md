# Система управления переговорными комнатами

## Описание

Система управления переговорными комнатами позволяет:
- Вести расписание занятости переговорных на месяц вперед
- Бронировать переговорные с шагом полчаса
- Запрашивать возможность снятия брони или переноса брони
- Прикладывать документы, ссылки, видеовстречи к бронированиям
- Настраивать уведомления в приложении, телеграм, почту
- Просматривать текущее состояние переговорных
- Предлагать свободные слоты при бронировании

## Структура системы

### Пользовательская часть
- **Страница переговорных** (`/meeting-rooms`) - основной интерфейс для пользователей
- **Бронирование комнат** - создание, редактирование, отмена бронирований
- **Просмотр расписания** - календарь занятости комнат
- **Запросы на изменение** - запросы к владельцам бронирований

### Административная часть
- **Управление комнатами** (`/admin/meeting-rooms`) - создание, редактирование, удаление переговорных
- **Просмотр статистики** - общая информация о комнатах и их использовании
- **Управление расписанием** - просмотр всех бронирований

### Уведомления
- **Кнопка уведомлений** в хедере - круглая кнопка с иконкой письма слева от профиля
- **История уведомлений** - просмотр всех уведомлений пользователя
- **Настройки уведомлений** - конфигурация способов доставки

## Установка и настройка

### 1. Миграции базы данных

```bash
cd orgchart/backend
npx sequelize-cli db:migrate
```

### 2. Сидеры (демо-данные)

```bash
npx sequelize-cli db:seed:all
```

### 3. Запуск сервера

```bash
# Backend
cd orgchart/backend
npm start

# Frontend
cd orgchart/frontend
npm run dev
```

## API Endpoints

### Переговорные комнаты
- `GET /api/meeting-rooms/rooms` - получить все комнаты
- `GET /api/meeting-rooms/rooms/:id` - получить комнату по ID
- `POST /api/meeting-rooms/rooms` - создать комнату (админ)
- `PUT /api/meeting-rooms/rooms/:id` - обновить комнату (админ)
- `DELETE /api/meeting-rooms/rooms/:id` - удалить комнату (админ)

### Расписание и слоты
- `GET /api/meeting-rooms/rooms/:id/schedule` - расписание комнаты
- `GET /api/meeting-rooms/rooms/:id/slots` - свободные слоты

### Бронирования
- `POST /api/meeting-rooms/bookings` - создать бронирование
- `GET /api/meeting-rooms/bookings` - мои бронирования
- `GET /api/meeting-rooms/bookings/:id` - получить бронирование
- `PUT /api/meeting-rooms/bookings/:id` - обновить бронирование
- `DELETE /api/meeting-rooms/bookings/:id` - отменить бронирование

### Запросы на изменение
- `POST /api/meeting-rooms/bookings/:id/request-change` - запросить изменение
- `GET /api/meeting-rooms/booking-requests` - мои запросы

## Модели данных

### MeetingRoom
```javascript
{
  id: INTEGER,
  name: STRING,           // Название комнаты
  description: TEXT,      // Описание
  capacity: INTEGER,      // Вместимость
  location: STRING,       // Расположение
  equipment: TEXT,        // Оборудование (JSON)
  is_active: BOOLEAN,     // Активна ли комната
  color: STRING,          // Цвет для отображения
  created_at: DATE,
  updated_at: DATE
}
```

### MeetingRoomBooking
```javascript
{
  id: INTEGER,
  meeting_room_id: INTEGER,    // ID комнаты
  employee_id: INTEGER,        // ID сотрудника
  title: STRING,              // Название встречи
  description: TEXT,           // Описание
  start_time: DATE,           // Время начала
  end_time: DATE,             // Время окончания
  participants: TEXT,          // Участники (JSON)
  documents: TEXT,            // Документы (JSON)
  video_link: STRING,         // Ссылка на видеовстречу
  location_address: TEXT,     // Адрес места проведения
  product_id: INTEGER,        // Связь с продуктом
  status: ENUM,               // confirmed/pending/cancelled
  notifications: TEXT,         // Настройки уведомлений (JSON)
  created_at: DATE,
  updated_at: DATE
}
```

### BookingRequest
```javascript
{
  id: INTEGER,
  booking_id: INTEGER,        // ID бронирования
  requester_id: INTEGER,      // ID запрашивающего
  request_type: ENUM,         // cancel/reschedule
  new_start_time: DATE,       // Новое время начала
  new_end_time: DATE,         // Новое время окончания
  reason: TEXT,               // Причина запроса
  status: ENUM,               // pending/approved/rejected
  response_message: TEXT,     // Ответ на запрос
  created_at: DATE,
  updated_at: DATE
}
```

## Функциональность

### Бронирование комнат
1. Выбор переговорной комнаты
2. Выбор даты и времени (с шагом 30 минут)
3. Заполнение информации о встрече
4. Добавление участников, документов, ссылок
5. Настройка уведомлений
6. Подтверждение бронирования

### Управление бронированиями
- Просмотр списка своих бронирований
- Редактирование деталей встречи
- Отмена бронирования
- Запрос изменения у владельца

### Административные функции
- Создание и редактирование переговорных комнат
- Просмотр статистики использования
- Управление статусом комнат (активна/неактивна)
- Просмотр расписания всех комнат

### Уведомления
- Внутри приложения
- Email уведомления
- Telegram уведомления
- Настраиваемое время предупреждения (5, 15, 30, 60 минут)

## Интерфейс

### Пользовательская страница
- Список доступных переговорных комнат
- Карточки с информацией о комнатах
- Кнопка быстрого бронирования
- Список моих бронирований
- Модальные окна для создания/редактирования

### Административная страница
- Таблица всех переговорных комнат
- Статистика использования
- Формы создания/редактирования
- Просмотр расписания комнат

### Кнопка уведомлений
- Круглая кнопка с иконкой письма
- Счетчик непрочитанных уведомлений
- Выпадающий список уведомлений
- Возможность отметить как прочитанные

## Безопасность

- Аутентификация через JWT токены
- Проверка прав доступа для административных функций
- Валидация данных на сервере
- Защита от конфликтов бронирований

## Расширения

Система может быть расширена:
- Интеграция с календарными системами
- Автоматические уведомления через webhook
- API для внешних систем
- Мобильное приложение
- Интеграция с системами видеоконференций 